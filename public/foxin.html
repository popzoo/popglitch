<!DOCTYPE html>
<html>

<head>
    <title>小妲己</title>
    <meta name="keywords" content="小妲己,小奶猫" />
    <meta name="description" content="小妲己,小奶猫" />
    <meta name="robots" content="index,follow"/>
    <meta name="author" content="lvlanxing"/>
    <meta name="google" value="notranslate"/>
    <!-- 网页控制 -->
    <meta name="referrer" content="no-referrer"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="Access-Control-Allow-Origin" content="*"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <!-- <link rel="shortcut icon" href="/img/favicon.ico"/> -->
    <link rel="shortcut icon" href="https://lvsfbqec.shdkw1o.com/favicon.ico">
    <!-- <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/popzoo/pop/images/favicon.ico"> -->
    <!-- iphone suitable -->
    <meta name="theme-color" content="#000000"/>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=0.9,maximum-scale=1.0,minimum-scale=0.5"/>
    <link rel="apple-touch-icon" href="https://lvsfbqec.shdkw1o.com/favicon.ico"/>
    <meta name="apple-mobile-web-app-title" content="小妲己"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="format-detection" content="email=no"/>   
    <!-- <link href="//vjs.zencdn.net/5.19.2/video-js.min.css" rel="stylesheet"> -->
    <!-- <script src="//vjs.zencdn.net/5.19.2/video.min.js"></script> -->
    <link href="https://unpkg.com/video.js@5.20.5/dist/video-js.min.css" rel="stylesheet">
    <script src="https://unpkg.com/video.js@5.20.5/dist/video.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/videojs-flash@2/dist/videojs-flash.min.js"></script> -->
    <style>
        .snow-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:-2}*{touch-action:pan-y}.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media(max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}
    </style>
</head>

<body style="background-color: #151515;margin:0 0;">
    <a id="left_link" href="https://github.com/xqf8188/wksj/blob/c128620f5301b41c87a62b42d836570fd8c39f76/xdj.js"
        class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250"
            style="fill:#64CEAA; color:#fff; position: fixed; top: 0; border: 0; left: 0; transform: scale(-1, 1);z-index: 10;"
            aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path
                d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path
                d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body"></path>
        </svg></a>
    <a id="right_link" href="#" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80"
            viewbox="0 0 250 250"
            style="fill:#70B7FD; color:#fff; position: fixed; top: 0; border: 0; right: 0;z-index: 100;"
            aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path
                d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path
                d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body"></path>
        </svg></a>
    <div id="content" style="text-align:center;">
        <!--vjs-big-play-centered 播放按钮居中-->
        <!--poster默认的显示界面，就是还没点播放，给你显示的界面-->
        <!--controls 规定浏览器应该为视频提供播放控件-->
        <!--preload="auto" 是否提前加载-->
        <!--autoplay 自动播放-->
        <!--loop=true 自动循环-->
        <!--src: 规定媒体文件的 URL  type:规定媒体资源的类型-->
        <!-- data-setup='{"example_option":true}' 可以把一些属性写到这个里面来，如data-setup={"autoplay":true}  vjs-fluid  width="600" height="400" -->
        <!-- <video id="my-player" style="margin:0 auto 0;height:100vh;width: 50vw" -->
        <video id="my-player" style="margin:0 auto 0;height:100vh;width: 80vw"
            class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto" autoplay="autoplay"
            poster="./img/hotgirl_2.jpg" data-setup="{}">
            <!-- <source src="//vjs.zencdn.net/v/oceans.mp4" type="video/mp4"> style="position: fixed; top:0; right:0; visibility: inherit;font-size: 16px;"
            </source> -->
        </video>
        <div id="show_ctrl_div" style="position: fixed; right:calc(12.5vw - 86.5px); bottom: 10px;"
            onmouseover="showBottomBar()" onmouseout="hiddenBottomBar()">
            <div id="show_hide_div" style="visibility: inherit; z-index: 999;">
                <p><button id="btn_change_room"
                        style="height: 30px;border-radius: 15px;color:white;background:rgb(38, 190, 132);border: transparent;"
                        onclick="randomScan()">随机换房间</button>
                </p>
                <p><button id="btn_live_stream"
                        style="height: 30px;border-radius: 15px;color:white;background:rgb(144, 77, 233);border: transparent;">复制直播源</button>
                </p>
                <p><button id="btn_vlc"
                        style="height: 30px;border-radius: 15px;color:white;background:rgb(248, 150, 70);border: transparent;">VLC播放</button>
                </p>
                <!-- <p><button id="btn_infuse"
                        style="height: 30px;border-radius: 15px;color:white;background:rgb(108, 120, 226);border: transparent;">Infuse播放</button>
                </p> -->
                <!-- <p><button id="btn_nplayer"
                    style="height: 30px;border-radius: 15px;color:white;background:rgb(228, 72, 168);border: transparent;">Nplayer播放</button>
                </p> -->
                <p><button id="btn_potplayer"
                        style="height: 30px;border-radius: 15px;color:white;background:rgb(228, 72, 168);border: transparent;">PotPlayer播放</button>
                </p>
                <p><button id="btn_oplayerlite"
                        style="height: 30px;border-radius: 15px;color:white;background:rgb(1, 156, 184);border: transparent;">OplayerLite播放</button>
                </p>
                <p style="color:burlywood">🛕<span id="title_name">无</span>🛕</p>
                <p style="color:chocolate">👒房号➰<span id="title_id">00000</span>👒</p>
                <p><a href="https://www.flash.cn/download-wins"
                        style="color: rgb(38, 192, 24);text-decoration: none;">『⭕FlashPlayer Install』</a>
                </p>
                <p><a href="#" id="btn_img_click"><img id="anchor_avatar"
                            src="https://fakeimg.pl/200x200/282828/FFA273/?text=%E5%8A%A0%E8%BD%BD%E4%B8%AD&font=noto"
                            width="200px" height="200px" style="border-radius: 10px;" alt="avatar"></a></p>
            </div>
        </div>
    </div>
    <script src="./js/Browser.js"></script>
    <script src="https://code.jquery.com/jquery-1.7.2.min.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JG6PBMLH1B"></script>
    <script type="text/javascript">
        var staticLink = sessionStorage.getItem('staticLink');
        var serverUrl = document.location.protocol + "//" + document.domain;
        (function ctrlBackEffect() {
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-JG6PBMLH1B');
            var scriptNode = document.createElement("script");
            scriptNode.setAttribute("type", "text/javascript");
            if (localStorage.getItem('showBack') != 'off') {
                scriptNode.setAttribute("src", "./js/snowy.js");
                document.body.appendChild(scriptNode);
            }
        })();
        (function initProgram() {
            checkBrowser()
            isMobileDevice();
            getVideoStream();
            if (staticLink == null) {
                renewStaticLink();
            }
        })()
        function checkBrowser() {
            var info = new Browser();
            console.debug('Current Browser:' + info.browser);//toLowerCase()
            if (info.browser.indexOf('Chrome') > -1 || info.browser.indexOf('Safari') > -1 || info.browser.indexOf('Edge') > -1 || info.browser.indexOf('Firefox') > -1) {
                if (sessionStorage.getItem('AlreadyAlert') == null) {
                    sessionStorage.setItem('AlreadyAlert', 'true');
                    alert('若要网页观看，请使用支持Flash的浏览器，如360、搜狗、QQ浏览器等，或采用右侧第三方软件跳转观影！')
                }
            }
        }
        function isMobileDevice() {
            if (/Android|webOS|ucweb|midp|MicroMessenger|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {// mobile模式
                // document.getElementById('my-player').style.width = '50vw';
                document.getElementById('show_ctrl_div').setAttribute('style', 'position: fixed; bottom:10px;left:calc(50vw - 100px);');
                document.getElementById('my-player').style.display = 'none';
            }else{
                setTimeout(hiddenBottomBar, 5000);//pc则隐藏
            }
        }
        function showBottomBar() {
            document.getElementById("show_hide_div").style.visibility = 'inherit';

        }
        function hiddenBottomBar() {
            document.getElementById("show_hide_div").style.visibility = 'hidden';
        }
        function btnClickEvent(msg) {
            sessionStorage.setItem("renderStatus", msg);
            location.href = serverUrl;
        }
        function randomScan() {
            let uidList = sessionStorage.getItem("uidList");
            let uidRenew = sessionStorage.getItem('uidRenew');
            if (uidList != null) {
                try {
                    uidList = JSON.parse(uidList);
                    if (uidList.length > 1 && new Date().getTime() - parseInt(uidRenew) < 1000 * 180) {//3min renew
                        let uid = uidList[parseInt(Math.random() * uidList.length)];
                        console.debug(uid);
                        location.href = serverUrl + '/room/' + uid;
                        // sessionStorage.setItem('roomId', uid);
                        // location.reload();
                    } else {
                        renewUidList();
                    }
                } catch (e) {
                    console.error('Json Parse Fail', e);
                }
            } else {
                renewUidList();
            }
        }
        function renewUidList() {
            fetch(serverUrl + '/api/hot', {
                method: 'GET',
                mode: 'cors',
                cache: 'no-cache',
                // headers: {
                //     'Authorization': getCookie('token')
                // },
                credentials: 'omit'
            }).then(result => {
                return result.json();
            }).then(json => {
                if (json != undefined && json.list != undefined) {
                    var roomList = json.list, uidList = [];
                    for (let i = 0; i < roomList.length; i++) {
                        if (roomList[i].is_scroll && roomList[i].id != null) { //true 为真人，false为广告
                            uidList.push(roomList[i].id);
                        }
                    }
                    sessionStorage.setItem('uidList', JSON.stringify(uidList));
                    sessionStorage.setItem('uidRenew', new Date().getTime().toString());
                } else {
                    console.error('Json Data Lost!');
                }
            }).catch(err => {
                console.error('ERROR', err);
            })
        }
        // parse url parameter value
        // getQueryVariable('uid')
        // function getQueryVariable(variable) {
        //     var query = window.location.search.substring(1);
        //     var vars = query.split("&");
        //     for (var i = 0; i < vars.length; i++) {
        //         var pair = vars[i].split("=");
        //         if (pair[0] == variable) { return pair[1]; }
        //     }
        //     return (false);
        // }
        function getUidFromUrl() {
            if (window.location.href.indexOf('/room/') > -1) {
                return window.location.href.substring(window.location.href.lastIndexOf('/') + 1);
            } else {
                return false;//'2720603'
            }
        }
        function getVideoStream() {
            let uid = getUidFromUrl();
            if (uid) {
                let detailUrl = serverUrl + '/api/stream?uid=' + uid;
                fetch(detailUrl, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'default',
                    // headers: {
                    //     'Authorization': getCookie('token')
                    // },
                    credentials: 'omit'
                }).then(result => {
                    return result.json();
                }).then(json => {
                    // console.log(json);
                    if (json != undefined && json.data != undefined && json.data.stream != undefined && json.data.stream.pull_url != null) {//&&  != 'none'
                        let roomRtmp = json.data.stream.pull_url;
                        sessionStorage.setItem(uid, roomRtmp);
                        console.debug(roomRtmp);
                        document.getElementById('title_name').innerText = json.data.anchor.nickname;
                        document.getElementById('title_id').innerText = json.data.anchor.id;
                        checkImgExist(staticLink + json.data.anchor.snap);
                        // document.getElementById('anchor_avatar').src = staticLink + json.data.anchor.snap;
                        // console.info(staticLink + json.data.anchor.snap)
                        playVideoByRTMP(roomRtmp);
                    } else if (sessionStorage.getItem(uid) != null) {//这里无法反馈推流是否失效，需手动点击换源
                        let roomRtmp = sessionStorage.getItem(uid);
                        playVideoByRTMP(roomRtmp);
                    } else {
                        console.error('当前房间无推流或为VIP包房，请更换其他房间！');
                        var isJump = window.confirm('当前房间无拉流或为VIP包房，是否更换房间？');
                        if (isJump) {// alert('无直播流或是VIP包房，请更换其他房间！');
                            randomScan();
                        }
                    }
                }).catch(err => {
                    console.error('ERROR', err);
                })
            } else {
                console.error("无法获取房间号，请重试！");
            }
        }
        function checkImgExist(imgurl) {
            var img = new Image();
            img.onload = function () {
                document.getElementById('anchor_avatar').src = imgurl;
            };
            img.onerror = function () {
                // console.error("img not found!");
                document.getElementById('anchor_avatar').src = staticLink + '/style/images/default_v9.png';
            };
            img.src = imgurl;//注意:src属性一定要写到 onload 的后面
        }
        // CheckImgExists(imgurl).then(() => {//success callback
        //     console.error("2000");
        //     document.getElementById('anchor_avatar').src = staticLink + json.data.anchor.snap;
        // }).catch(() => {//fail callback
        //     console.error("404");
        //     document.getElementById('anchor_avatar').src = 'https://fakeimg.pl/200x200/282828/FFA273/?text=%E6%97%A0%E5%9B%BE&font=noto';
        // })
        // function CheckImgExists(imgurl) {
        //     return new Promise(function (resolve, reject) {
        //         var ImgObj = new Image(); //判断图片是否存在
        //         ImgObj.src = imgurl;
        //         ImgObj.onload = function (res) {
        //             resolve(res);
        //         }
        //         ImgObj.onerror = function (err) {
        //             reject(err)
        //         }
        //     })
        // }
        function playVideoByRTMP(roomRtmp) {
            // ====================== Third Player ======================
            document.getElementById('btn_potplayer').addEventListener('click', () => {
                location.href = 'potplayer://' + roomRtmp;
            });
            document.getElementById('btn_oplayerlite').addEventListener('click', () => {
                location.href = 'oplayerlite://' + roomRtmp;
            });
            document.getElementById('btn_img_click').addEventListener('click', () => {
                location.href = 'oplayerlite://' + roomRtmp;
            });
            // document.getElementById('btn_infuse').addEventListener('click', () => {
            //     location.href = 'infuse://' + roomRtmp;
            // });
            document.getElementById('btn_vlc').addEventListener('click', () => {
                location.href = 'vlc://' + roomRtmp;
            });
            // document.getElementById('btn_nplayer').addEventListener('click', () => {
            //     location.href = 'nplayer-' + roomRtmp;
            // });                                                    
            // ====================== paste boder ======================
            const btn = document.querySelector('#btn_live_stream');
            btn.addEventListener('click', () => {
                const input = document.createElement('input');
                document.body.appendChild(input);
                input.setAttribute('value', roomRtmp);
                input.select();
                if (document.execCommand('copy')) {
                    document.execCommand('copy');
                    console.debug('复制成功');
                }
                document.body.removeChild(input);
            })
            // 设置flash路径,在videojs发现浏览器不支持HTML5时唤起flash播放器，rtmp流只能用这个
            // videojs.options.flash.swf = 'https://cdn.jsdelivr.net/gh/videojs/video-js-swf/dist/video-js.swf';
            videojs.options.flash.swf = './js/video-js.swf';
            var player = videojs('my-player');
            player.src({
                src: roomRtmp,
                type: 'rtmp/flv'
            })
            player.play(); //播放  player.pause()                  
        }
        // get static link
        function renewStaticLink() {
            // if (staticLink == null) {
            fetch(serverUrl + '/api/appconf', {
                method: 'GET',
                mode: 'cors',
                cache: 'default',
                credentials: 'omit'
            }).then(result => {
                return result.json();
            }).then(json => {
                if (json != undefined && json.code == 0) {
                    staticLink = json.data.host.static;
                    sessionStorage.setItem('staticLink', json.data.host.static);
                    // } else {
                    // staticLink = 'https://cdn.yywyq.com';
                    location.reload();
                }
            }).catch(err => {
                console.error('ERROR', err);
            })
        }
        // get cookie
        function getCookie(name) {
            var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
            return (arr = document.cookie.match(reg)) ? unescape(arr[2]) : null;
        }
    </script>
    <div class="snow-container"></div>
</body>

</html>